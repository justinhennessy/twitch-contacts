<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact List</title>
    <link rel="stylesheet" href="style.css">
    <script src="/js/date_time.js"></script>
</head>
<body>
    <div id="contact-list"></div>
    <script src="/js/people.js"></script>
    <script src="/js/message_count.js"></script>
    <script src="/js/main.js"></script>
    <script>
        function getSphereColor(chatter_type) {
            switch (chatter_type) {
                case 'known':
                    return 'blue';
                case 'unknown':
                    return 'grey';
                case 'bot':
                    return 'orange';
                case 'vip':
                    return 'lightgreen';
                default:
                    return 'grey';
            }
        }

        function renderList(list) {
            if (!list || !Array.isArray(list)) {
                return '';
            }

            // Sort the list by date in descending order
            const sortedList = list.slice().sort(sortByDateDescending);

            return sortedList.map(item => {
                const date = formatDate(item.Date);
                const entry = item.Entry || 'unknown';
                return `${date}: ${entry}`;
            }).join('\n');
        }

        function createPersonElement(person) {
            const personContainer = document.createElement('div');
            const sphere = document.createElement('div');
            const details = document.createElement('div');
            const username = document.createElement('p');
            const hoverModal = document.createElement('div'); // Add hover modal element

            personContainer.className = 'person-container';
            sphere.className = 'sphere';
            details.className = 'details';
            hoverModal.className = 'hover-modal rounded'; // Add class name to hover modal

            username.innerText = `${person.username}\n`;

            const realName = person.realName ? `RealName: ${person.realName}\n` : '';
            const firstChat = person.first_chatted ? `First Chat: ${timeSince(person.first_chatted)}\n` : '';
            const lastChat = person.last_chatted ? `Last Chat: ${timeSince(person.last_chatted)}\n` : '';
            const aspirations = person.aspirations ? `Aspirations: ${person.aspirations}\n` : '';
            const songRequests = person.song_requests?.length ? `\nSong Requests:\n${renderList(person.song_requests)}\n` : '';
            const journal = person.journal?.length ? `\nJournal:\n${renderList(person.journal)}\n` : '';

            hoverModal.innerText = `${realName}${firstChat}${lastChat}${aspirations}${songRequests}${journal}`;

            details.appendChild(username);
            personContainer.appendChild(sphere);
            sphere.appendChild(hoverModal); // Add hover modal to sphere element
            personContainer.appendChild(details); // Add details after sphere

            return personContainer;
        };
    </script>
</body>

</html>